@model IEnumerable<CIC_APPROVE.Models.Vw_Approve>

@{
    ViewBag.Title = "CIC Approval List";
}
@using CIC_APPROVE.Helpers

<div class="container-fluid mt-3">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="fw-bold text-primary">
            <i class="bi bi-check2-square"></i> รายการอนุมัติ CIC
        </h3>

        @*@Html.ActionLink(
                "เพิ่มรายการ CIC",
                "Create",
                null,
                new { @class = "btn btn-success" }
            )*@
    </div>
    <form method="get" class="mb-3">
        <div class="input-group">
            <input type="text"
                   name="search"
                   value="@ViewBag.CurrentSearch"
                   class="form-control"
                   placeholder="ค้นหา CIC No / ชื่อ / แผนก" />
            <button class="btn btn-primary" type="submit">
                ค้นหา
            </button>
        </div>
    </form>

    <!-- Table -->
    <div class="card shadow-sm">
        <div class="card-body">

            <table class="table table-bordered table-hover align-middle">
                <thead class="table-light text-center">
                    <tr>
                        <th style="width:60px;">ลำดับ</th>
                        <th>CIC</th>
                        <th>เลขที่เอกสาร</th>
                        <th>เลขที่เอกสาร</th>
                        <th>ผู้สร้างเอกสาร</th>
                        <th>สถานะ</th>
                        <th style="width:180px;">การทำงาน</th>
                    </tr>
                </thead>

                <tbody>
                    @foreach (var item in Model)
                    {
                        string statusClass = "text-dark";

                        if (item.StatusID == 1)
                        {
                            statusClass = "text-primary fw-semibold";
                        }
                        else if (item.StatusID == 4)
                        {
                            statusClass = "text-warning fw-semibold";
                        }

                        var token = CryptoHelper.Encrypt(item.Dept_No);

                        <tr>
                            <td class="text-center">@item.NO_</td>
                            <td>@item.CIC</td>
                            <td>@item.Dept_No</td>
                            <td>@item.CIC_No</td>
                            <td>@item.Name_user</td>
                            <td class="@statusClass">@item.StatusName</td>
                            <td class="text-center">
                                <a href="@Url.Action("Approve", "Vw_Approve", new { id = token })"
                                   class="btn btn-primary btn-sm">
                                    Approve
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>

        </div>
    </div>


</div>
@{
    int totalPage = (int)ViewBag.TotalPage;
    int currentPage = (int)ViewBag.CurrentPage;

    int pageGroupSize = 10;
    int startPage = ((currentPage - 1) / pageGroupSize) * pageGroupSize + 1;
    int endPage = Math.Min(startPage + pageGroupSize - 1, totalPage);
}

<nav aria-label="Page navigation" class="d-flex justify-content-center">
    <ul class="pagination">

        <!-- Prev -->
        @if (currentPage > 1)
        {
            <li class="page-item">
                <a class="page-link"
                   href="@Url.Action("Index", new { page = currentPage - 1, search = ViewBag.CurrentSearch })">
                    «
                </a>
            </li>
        }

        <!-- Page Numbers -->
        @for (int i = startPage; i <= endPage; i++)
        {
            <li class="page-item @(currentPage == i ? "active" : "")">
                <a class="page-link"
                   href="@Url.Action("Index", new { page = i, search = ViewBag.CurrentSearch })">
                    @i
                </a>
            </li>
        }

        <!-- Next -->
        @if (currentPage < totalPage)
        {
            <li class="page-item">
                <a class="page-link"
                   href="@Url.Action("Index", new { page = currentPage + 1, search = ViewBag.CurrentSearch })">
                    »
                </a>
            </li>
        }

    </ul>
</nav>
